<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIC Islamabad | Room Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f7f8fa;
        }
        :root {
            --brand-olive-dark: #3E4A39;
            --brand-olive-mid: #6A7B63;
            --brand-olive-light: #A8B8A0;
            --brand-gold: #D4AF37;
            --background-light: #F7F8FA;
            --card-bg: #FFFFFF;
            --text-dark: #1a202c;
            --text-light: #4a5568;
            --border-color: #e2e8f0;
        }
        .nav-link.active {
            background-color: rgba(62, 74, 57, 0.08);
            color: var(--brand-olive-dark);
            font-weight: 700;
            border-left: 4px solid var(--brand-olive-dark);
        }
        .page { 
            animation: pageEnter 0.7s cubic-bezier(0.25, 1, 0.5, 1);
        }
        @keyframes pageEnter {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .auth-view {
            animation: authEnter 0.5s ease-out;
        }
        @keyframes authEnter {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .btn-primary {
            background-color: var(--brand-olive-dark);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
        }
        .btn-primary:hover {
            background-color: var(--brand-olive-mid);
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
        }
        .btn-primary:active {
            transform: translateY(0px);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
        }
        .input-focus:focus {
            --tw-ring-color: var(--brand-olive-light);
        }

        /* Fun Animations & Effects */
        .stat-card {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
        }
        .calendar-day:hover {
            transform: scale(1.1);
            background-color: rgba(62, 74, 57, 0.1);
        }
        #confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--brand-gold);
            opacity: 0;
            animation: fall 3s linear infinite;
        }
        .confetti.triangle {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 10px solid var(--brand-olive-light);
            background-color: transparent;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }

        /* Tablet Display Styles */
        #tablet-view-container .content-wrapper {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        #password-modal > div {
             animation: modalEnter 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        @keyframes modalEnter {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
    </style>
</head>
<body class="text-gray-800 antialiased">
    <div id="confetti-container"></div>

    <!-- Authentication Container -->
    <div id="auth-container" class="w-full h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-green-50">
        <div class="w-full max-w-md auth-card">
              <!-- Login View -->
            <div id="login-view" class="auth-view bg-white p-8 rounded-xl shadow-2xl shadow-gray-200">
                <div class="flex justify-center mb-6 h-12">
                    <!-- Logo will be added here -->
                </div>
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-extrabold text-gray-800">Welcome Back</h1>
                    <p class="text-gray-500 mt-2">Sign in to manage your bookings.</p>
                </div>
                <div id="login-error" class="mb-4 text-red-600 text-sm font-medium"></div>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="login-email" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                    </div>
                    <button type="submit" class="w-full py-3 rounded-lg font-semibold btn-primary">Login Securely</button>
                </form>
                <p class="text-center text-sm text-gray-600 mt-6">
                    A startup? <a href="#" id="show-signup" class="font-semibold text-green-700 hover:underline">Create an Account</a>
                </p>
            </div>
            <!-- Signup View -->
            <div id="signup-view" class="auth-view bg-white p-8 rounded-xl shadow-2xl shadow-gray-200 hidden">
                 <div class="flex justify-center mb-6 h-12">
                    <!-- Logo will be added here -->
                </div>
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-2">Create Account</h2>
                <p class="text-center text-gray-500 mb-8">Register your startup to get started.</p>
                 <div id="signup-error" class="mb-4 text-red-600 text-sm"></div>
                <form id="signup-form" class="space-y-4">
                    <input type="text" id="signup-startupName" placeholder="Startup Name" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                    <input type="text" id="signup-contactPerson" placeholder="Contact Person" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                    <input type="tel" id="signup-phone" placeholder="Phone Number" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                    <input type="email" id="signup-email" placeholder="Email Address" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                    <input type="password" id="signup-password" placeholder="Password" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                    <button type="submit" class="w-full py-3 rounded-lg font-semibold btn-primary">Create Account</button>
                </form>
                <p class="text-center text-sm text-gray-600 mt-6">
                    Already a member? <a href="#" id="show-login" class="font-semibold text-green-700 hover:underline">Login</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="flex h-screen bg-white hidden">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white text-gray-700 flex flex-col shadow-lg border-r flex-shrink-0">
            <div class="h-20 flex items-center justify-center border-b border-gray-200 px-4">
                <!-- Logo will be added here -->
            </div>
            <nav class="flex-1 px-4 py-4 space-y-2">
                <a href="#dashboard" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                    <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    Dashboard
                </a>
                <a href="#startups" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                     <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    Startups
                </a>
                <a href="#booking" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                    <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    Book a Room
                </a>
                <a href="#my-bookings" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                   <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                   My Bookings
                </a>
                <a href="#schedule" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                     <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    Schedule
                </a>
                 <a href="#room-displays" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                    <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    Room Displays
                </a>
                 <a href="#reports" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                    <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    Reports
                </a>
                 <a href="#policies" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                    <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    Policies
                </a>
                 <a href="#contact" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                    <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    Contact Us
                </a>
                 <a href="#settings" class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-green-50 hover:text-green-700 transition duration-200">
                    <svg class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    Settings
                </a>
            </nav>
            <div class="px-4 py-4 border-t border-gray-200">
                <div id="user-profile" class="flex items-center">
                    <img id="user-avatar" class="h-10 w-10 rounded-full object-cover" src="https://placehold.co/100x100/E2E8F0/475569?text=U" alt="User photo">
                    <div class="ml-3">
                        <p id="user-name" class="text-sm font-semibold text-gray-800">User</p>
                        <a href="#" id="logout-btn" class="text-xs text-gray-500 hover:text-green-600">Logout</a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 md:p-10 overflow-y-auto bg-gray-50">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page">
                 <h2 id="welcome-message" class="text-4xl font-extrabold mb-8 text-gray-800">Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Stat Card -->
                    <div class="stat-card bg-white p-6 rounded-xl shadow-lg shadow-gray-100 flex items-center justify-between border-t-4 border-green-500">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Registered Startups</p>
                            <p id="total-startups-stat" class="text-3xl font-bold text-gray-700">0</p>
                        </div>
                        <div class="bg-green-100 text-green-700 rounded-full p-3">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                        </div>
                    </div>
                    <!-- Stat Card -->
                    <div class="stat-card bg-white p-6 rounded-xl shadow-lg shadow-gray-100 flex items-center justify-between border-t-4 border-blue-500">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Upcoming Bookings</p>
                            <p id="upcoming-bookings-stat" class="text-3xl font-bold text-gray-700">0</p>
                        </div>
                         <div class="bg-blue-100 text-blue-700 rounded-full p-3">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        </div>
                    </div>
                     <!-- Stat Card -->
                    <div class="stat-card bg-white p-6 rounded-xl shadow-lg shadow-gray-100 flex items-center justify-between border-t-4 border-yellow-500">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Most Booked Room</p>
                            <p id="most-booked-room" class="text-xl font-bold text-gray-700 truncate">None</p>
                        </div>
                         <div class="bg-yellow-100 text-yellow-700 rounded-full p-3">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>
                        </div>
                    </div>
                </div>
                <h3 class="text-2xl font-bold mb-4 text-gray-800">Today's Schedule</h3>
                <div id="todays-bookings" class="bg-white p-4 rounded-xl shadow-lg shadow-gray-100">
                    <!-- Today's bookings will be listed here -->
                </div>
            </div>

            <!-- Startups Page -->
            <div id="startups" class="page hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-4xl font-extrabold text-gray-800">Startups</h2>
                    <button id="add-startup-btn" class="px-5 py-2.5 rounded-lg font-semibold flex items-center btn-primary">
                        <svg class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                        Add Startup
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-lg shadow-gray-100 overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50">
                            <tr class="border-b border-gray-200">
                                <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider">Startup Name</th>
                                <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider">Contact Person</th>
                                <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider">Phone</th>
                                <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider">Email</th>
                                <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="startup-table-body">
                           <!-- Startup rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Booking Page -->
            <div id="booking" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">Create a New Booking</h2>
                <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100 max-w-2xl mx-auto">
                    <div id="booking-message" class="mb-4"></div>
                    <form id="booking-form" class="space-y-6">
                        <div>
                            <label for="startup-select" class="block text-sm font-medium text-gray-700 mb-1">Select Your Startup</label>
                            <select id="startup-select" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                        </div>
                        <div>
                            <label for="booking-date" class="block text-sm font-medium text-gray-700 mb-1">Date (24 hours prior booking required)</label>
                            <input type="date" id="booking-date" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label for="room-select" class="block text-sm font-medium text-gray-700 mb-1">Room</label>
                            <select id="room-select" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                        </div>
                        <div>
                            <label for="time-select" class="block text-sm font-medium text-gray-700 mb-1">Time Slot</label>
                            <select id="time-select" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                        </div>
                        <div>
                            <label for="duration-select" class="block text-sm font-medium text-gray-700 mb-1">Duration</label>
                            <select id="duration-select" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                        </div>
                        <div id="podcast-equipment-section" class="hidden">
                             <label for="podcast-equipment" class="block text-sm font-medium text-gray-700 mb-1">Equipment Needed</label>
                             <textarea id="podcast-equipment" rows="3" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="e.g., 2 microphones, 1 camera, ring light..."></textarea>
                        </div>
                        <div class="pt-2">
                             <label class="flex items-center space-x-3">
                                 <input type="checkbox" id="is-confidential" class="h-5 w-5 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                 <span class="text-gray-700">This is a confidential meeting</span>
                             </label>
                         </div>
                        <button type="submit" class="w-full py-3 px-4 rounded-lg font-semibold btn-primary">Confirm Booking</button>
                    </form>
                </div>
            </div>

             <!-- My Bookings Page -->
            <div id="my-bookings" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">My Bookings</h2>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-700">Upcoming Bookings</h3>
                        <div id="upcoming-bookings-list" class="space-y-4">
                            <!-- Upcoming bookings will be listed here -->
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-700">Past Bookings</h3>
                        <div id="past-bookings-list" class="space-y-4">
                            <!-- Past bookings will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Page -->
            <div id="schedule" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">Booking Schedule</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-gray-100">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                            <svg class="h-6 w-6 text-gray-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                        <h3 id="month-year" class="text-xl font-semibold text-gray-700"></h3>
                        <button id="next-month" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                            <svg class="h-6 w-6 text-gray-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1">
                        <!-- Calendar days will be inserted here -->
                    </div>
                </div>
                 <div id="schedule-details" class="mt-6"></div>
            </div>

            <!-- Room Displays Page -->
            <div id="room-displays" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">Room Displays</h2>
                <div id="room-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Room cards will be inserted here -->
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">Monthly Booking Report</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-gray-100 mb-6">
                    <div class="flex items-center space-x-4">
                        <div>
                            <label for="report-month" class="text-sm font-medium text-gray-700">Month</label>
                            <select id="report-month" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md"></select>
                        </div>
                        <div>
                            <label for="report-year" class="text-sm font-medium text-gray-700">Year</label>
                            <select id="report-year" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md"></select>
                        </div>
                    </div>
                </div>
                <div id="report-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Report cards will be inserted here -->
                </div>
            </div>

            <!-- Policies Page -->
            <div id="policies" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">Usage Policies</h2>
                <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100 max-w-4xl mx-auto space-y-6 text-gray-700 leading-relaxed">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">1. Property and Equipment Care</h3>
                        <p>All startups are expected to treat NIC Islamabad property, including furniture, electronics, and the rooms themselves, with the utmost care. Please leave the rooms in the same condition you found them. Report any pre-existing damage to the administration immediately upon discovery.</p>
                        <p class="mt-2 font-semibold">Any damages caused to NIC property during your booked session will result in fines corresponding to the repair or replacement cost of the damaged item(s).</p>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">2. Punctuality and Room Usage</h3>
                        <p>Your booking time includes setup and cleanup. Please ensure you vacate the room promptly at the end of your scheduled time to respect the schedule of the next startup.</p>
                        <p class="mt-2 font-semibold">Overusing a booked room beyond the scheduled time is strictly prohibited and will result in official warnings:</p>
                        <ul class="list-disc list-inside mt-2 pl-4 space-y-1">
                            <li><span class="font-bold">First Offense:</span> A formal warning will be issued.</li>
                            <li><span class="font-bold">Second Offense:</span> A second and final warning will be issued.</li>
                            <li><span class="font-bold">Third Offense:</span> A fine will be imposed, and booking privileges may be temporarily suspended.</li>
                        </ul>
                    </div>
                     <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">3. Booking Fairness and Restrictions</h3>
                        <p>To ensure fair access for all startups, monthly booking limits are in place. These policies are strictly enforced to maintain an equitable environment for everyone. Please see the specific limits below:</p>
                        <ul class="list-disc list-inside mt-4 pl-4 space-y-2 font-medium">
                            <li><span class="font-bold">All Focus Rooms:</span> 5 bookings per month (cumulative).</li>
                            <li><span class="font-bold">Indus-Board Room:</span> 1 booking per month.</li>
                            <li><span class="font-bold">Nexus-Session Hall:</span> 1 booking per month.</li>
                            <li><span class="font-bold">Podcast Room:</span> 1 booking per month.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Contact Page -->
            <div id="contact" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">Contact Us</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <!-- Contact Card 1 -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100">
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Jawad Ahmad</h3>
                        <p class="text-gray-600 mb-4 font-medium">Community Associate, NIC Islamabad</p>
                        <div class="space-y-3 text-gray-700">
                            <p class="flex items-center"><svg class="h-5 w-5 mr-3 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>03328020445</p>
                            <p class="flex items-center"><svg class="h-5 w-5 mr-3 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>Jawad.Ahmad@changemechanics.pk</p>
                        </div>
                    </div>
                    <!-- Contact Card 2 -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100">
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Ashraf Khan</h3>
                        <p class="text-gray-600 mb-4 font-medium">Admin and HR manager, NIC Islamabad</p>
                        <div class="space-y-3 text-gray-700">
                           <p class="flex items-center"><svg class="h-5 w-5 mr-3 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>03359177115</p>
                           <p class="flex items-center"><svg class="h-5 w-5 mr-3 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>Ashraf.khan@changemechanics.pk</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="settings" class="page hidden">
                <h2 class="text-4xl font-extrabold mb-8 text-gray-800">Settings</h2>
                <div class="space-y-10">
                     <!-- Manage Admins Section -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100 max-w-2xl mx-auto">
                        <h3 class="text-2xl font-bold mb-6 text-gray-700">Manage Admins</h3>
                        <div id="admin-message" class="mb-4"></div>
                        <ul id="admin-list" class="space-y-2 mb-4">
                            <!-- Admin list will be populated here -->
                        </ul>
                        <form id="add-admin-form" class="space-y-4">
                            <input type="text" id="new-admin-name" placeholder="Full Name" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                            <input type="email" id="new-admin-email" placeholder="Email Address" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                             <input type="password" id="new-admin-password" placeholder="Password" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                             <button type="submit" class="w-full px-4 py-2 rounded-lg font-semibold btn-primary">Add Admin</button>
                        </form>
                    </div>
                    <!-- Change Password Section -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100 max-w-2xl mx-auto">
                        <h3 class="text-2xl font-bold mb-6 text-gray-700">Change Your Password</h3>
                        <div id="password-change-message" class="mb-4"></div>
                        <form id="change-password-form" class="space-y-6">
                            <div>
                                <label for="current-password" class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
                                <input type="password" id="current-password" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500" required>
                            </div>
                            <div>
                                <label for="new-password" class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                                <input type="password" id="new-password" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500" required>
                            </div>
                            <div>
                                <label for="confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
                                <input type="password" id="confirm-password" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500" required>
                            </div>
                            <button type="submit" class="w-full py-3 px-4 rounded-lg font-semibold btn-primary">Update Password</button>
                        </form>
                    </div>
                    <!-- Manage Rooms Section -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100 max-w-2xl mx-auto">
                        <h3 class="text-2xl font-bold mb-6 text-gray-700">Manage Rooms</h3>
                        <ul id="room-list" class="space-y-2 mb-4">
                            <!-- Room list will be populated here -->
                        </ul>
                        <form id="add-room-form" class="flex gap-2">
                             <input type="text" id="new-room-name" placeholder="New room name" class="flex-grow border rounded-lg p-3 focus:ring-2 input-focus" required>
                             <button type="submit" class="px-4 py-2 rounded-lg font-semibold btn-primary">Add Room</button>
                        </form>
                    </div>
                     <!-- Booking Parameters Section -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-gray-100 max-w-2xl mx-auto">
                        <h3 class="text-2xl font-bold mb-6 text-gray-700">Booking Parameters</h3>
                        <div class="space-y-4">
                             <div>
                                <label for="buffer-time" class="block text-sm font-medium text-gray-700">Booking Buffer (minutes)</label>
                                <input type="number" id="buffer-time" min="0" step="5" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                             </div>
                             <button id="save-parameters-btn" class="w-full py-3 px-4 rounded-lg font-semibold btn-primary">Save Parameters</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Startup Modal -->
    <div id="startup-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md modal-content">
            <h3 id="modal-title" class="text-2xl font-bold mb-6 text-gray-800">Add Startup</h3>
            <form id="startup-form">
                <input type="hidden" id="startup-id">
                <div class="mb-4">
                    <label for="startupName" class="block text-sm font-medium text-gray-700 mb-1">Startup Name</label>
                    <input type="text" id="startupName" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                </div>
                 <div class="mb-4">
                    <label for="contactPerson" class="block text-sm font-medium text-gray-700 mb-1">Contact Person</label>
                    <input type="text" id="contactPerson" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                </div>
                 <div class="mb-4">
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" id="phone" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                </div>
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="email" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" required>
                </div>
                <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" id="cancel-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition duration-200">Cancel</button>
                    <button type="submit" class="px-4 py-2 rounded-lg font-semibold btn-primary">Save Startup</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Tablet View Container -->
    <div id="tablet-view-container" class="fixed inset-0 bg-gray-900 text-white p-8 flex-col justify-center items-center hidden z-50">
        <!-- Tablet content will be inserted here -->
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const getTodayDateString = () => {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    };

    // --- State Management (Mock Data) ---
    let admins = [
        { id: 'admin', name: 'Admin', email: 'admin@nic.com', password: 'admin', role: 'admin' }
    ];
    
    let startups = [
        { id: 1, name: 'InnovateX', contact: 'Ali Khan', phone: '03001234567', email: 'ali@innovatex.com', password: 'password123', role: 'startup' },
        { id: 2, name: 'TechSolutions', contact: 'Fatima Ahmed', phone: '03217654321', email: 'fatima@techsolutions.com', password: 'password123', role: 'startup' },
        { id: 3, name: 'EduGrowth', contact: 'Bilal Hassan', phone: '03339876543', email: 'bilal@edugrowth.com', password: 'password123', role: 'startup' },
    ];

    let bookings = [
        { id: 4, startupId: 2, room: 'Indus-Board Room', date: getTodayDateString(), time: '11:00 AM', duration: 2, equipmentNotes: '', isConfidential: false },
        { id: 5, startupId: 1, room: 'HUB (Focus Room)', date: '2025-09-22', time: '02:00 PM', duration: 1, equipmentNotes: '', isConfidential: true }

    ];

    let currentUser = null;
    let appInitialized = false;

    // --- App Configuration ---
    let timeSlots = ['09:00 AM', '10:00 AM', '11:00 AM', '12:00 PM', '01:00 PM', '02:00 PM', '03:00 PM', '04:00 PM', '05:00 PM'];
    let bufferMinutes = 30;

    let availableRooms = [
        { name: 'HUB (Focus Room)', maxDuration: 2, requiresEquipment: false, type: 'focus' },
        { name: 'Hingol (Focus Room)', maxDuration: 2, requiresEquipment: false, type: 'focus' },
        { name: 'Telenor Velocity Room', maxDuration: 2, requiresEquipment: false, type: 'special' },
        { name: 'Sutlej (Focus Room)', maxDuration: 2, requiresEquipment: false, type: 'focus' },
        { name: 'Chenab (Focus Room)', maxDuration: 2, requiresEquipment: false, type: 'focus' },
        { name: 'Jhelum (Focus Room)', maxDuration: 2, requiresEquipment: false, type: 'focus' },
        { name: 'Indus-Board Room', maxDuration: 8, requiresEquipment: false, type: 'special' },
        { name: 'Nexus-Session Hall', maxDuration: 8, requiresEquipment: false, type: 'special' },
        { name: 'Podcast Room', maxDuration: 2, requiresEquipment: true, type: 'special' }
    ];
    
    // --- Selectors ---
    const authContainer = document.getElementById('auth-container');
    const appContainer = document.getElementById('app');
    const loginView = document.getElementById('login-view');
    const signupView = document.getElementById('signup-view');
    const showSignupBtn = document.getElementById('show-signup');
    const showLoginBtn = document.getElementById('show-login');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const logoutBtn = document.getElementById('logout-btn');
    const loginError = document.getElementById('login-error');
    const signupError = document.getElementById('signup-error');
    
    const pages = document.querySelectorAll('.page');
    const navLinks = document.querySelectorAll('.nav-link');
    const startupTableBody = document.getElementById('startup-table-body');
    const startupModal = document.getElementById('startup-modal');
    const startupForm = document.getElementById('startup-form');
    const modalTitle = document.getElementById('modal-title');
    const addStartupBtn = document.getElementById('add-startup-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const bookingForm = document.getElementById('booking-form');
    const startupSelect = document.getElementById('startup-select');
    const roomSelect = document.getElementById('room-select');
    const durationSelect = document.getElementById('duration-select');
    const podcastEquipmentSection = document.getElementById('podcast-equipment-section');
    const timeSelect = document.getElementById('time-select');
    const bookingDateInput = document.getElementById('booking-date');
    const bookingMessage = document.getElementById('booking-message');
    const welcomeMessage = document.getElementById('welcome-message');
    const totalStartupsStat = document.getElementById('total-startups-stat');
    const upcomingBookingsStat = document.getElementById('upcoming-bookings-stat');
    const mostBookedRoom = document.getElementById('most-booked-room');
    const todaysBookingsContainer = document.getElementById('todays-bookings');
    const calendarGrid = document.getElementById('calendar-grid');
    const monthYearEl = document.getElementById('month-year');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    const scheduleDetails = document.getElementById('schedule-details');
    const myBookingsUpcomingList = document.getElementById('upcoming-bookings-list');
    const myBookingsPastList = document.getElementById('past-bookings-list');
    const roomDisplaysGrid = document.getElementById('room-grid');
    const tabletViewContainer = document.getElementById('tablet-view-container');
    // Reports selectors
    const reportMonthSelect = document.getElementById('report-month');
    const reportYearSelect = document.getElementById('report-year');
    const reportContent = document.getElementById('report-content');
    // Settings elements
    const changePasswordForm = document.getElementById('change-password-form');
    const passwordChangeMessage = document.getElementById('password-change-message');
    const adminMessage = document.getElementById('admin-message');
    const roomList = document.getElementById('room-list');
    const addRoomForm = document.getElementById('add-room-form');
    const bufferTimeInput = document.getElementById('buffer-time');
    const saveParametersBtn = document.getElementById('save-parameters-btn');
    const adminList = document.getElementById('admin-list');
    const addAdminForm = document.getElementById('add-admin-form');
    
    let currentEditingStartupId = null;
    let currentDate = new Date();

    // --- UI Helpers ---
    const triggerConfetti = () => {
        const container = document.getElementById('confetti-container');
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            if (Math.random() > 0.5) confetti.classList.add('triangle');
            confetti.style.left = `${Math.random() * 100}vw`;
            confetti.style.animationDelay = `${Math.random() * 2}s`;
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 60%)`;
            container.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }
    };

    // --- Authentication ---
    const handleLogin = () => {
        if (currentUser) {
            authContainer.classList.add('hidden');
            appContainer.classList.remove('hidden');
            
            document.getElementById('user-name').textContent = currentUser.name;
            welcomeMessage.innerHTML = `Welcome back, <span class="text-green-700">${currentUser.name.split(' ')[0]}</span>!`;
            const userInitial = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('user-avatar').src = `https://placehold.co/100x100/A8B8A0/3E4A39?text=${userInitial}`;

            const adminOnlyElements = [document.querySelector('a[href="#startups"]'), addStartupBtn, document.querySelector('a[href="#settings"]'), document.querySelector('a[href="#reports"]'), document.querySelector('a[href="#room-displays"]')];
            const startupOnlyElements = [document.querySelector('a[href="#my-bookings"]')];

            if (currentUser.role === 'admin') {
                adminOnlyElements.forEach(el => el.style.display = 'flex');
                startupOnlyElements.forEach(el => el.style.display = 'none');
            } else {
                adminOnlyElements.forEach(el => el.style.display = 'none');
                startupOnlyElements.forEach(el => el.style.display = 'flex');
            }

            if (!appInitialized) {
                initialize();
                appInitialized = true;
            }
            renderAll();
        } else {
            authContainer.classList.remove('hidden');
            appContainer.classList.add('hidden');
        }
    };

    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        loginError.textContent = '';
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        let foundUser = admins.find(a => a.email === email && a.password === password);
        if (!foundUser) {
            foundUser = startups.find(s => s.email === email && s.password === password) || null;
        }
        
        currentUser = foundUser;
        
        if (currentUser) {
            handleLogin();
        } else {
            loginError.textContent = 'Invalid email or password.';
        }
    });

    signupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        signupError.textContent = '';
        const email = document.getElementById('signup-email').value;

        const emailExists = startups.some(s => s.email === email) || admins.some(a => a.email === email);
        if (emailExists) {
            signupError.textContent = 'An account with this email already exists.';
            return;
        }

        const newStartup = {
            id: Date.now(),
            name: document.getElementById('signup-startupName').value,
            contact: document.getElementById('signup-contactPerson').value,
            phone: document.getElementById('signup-phone').value,
            email: email,
            password: document.getElementById('signup-password').value,
            role: 'startup'
        };

        startups.push(newStartup);
        currentUser = newStartup;
        handleLogin();
    });

    logoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        currentUser = null;
        appInitialized = false;
        window.location.hash = '';
        handleLogin();
    });

    showSignupBtn.addEventListener('click', (e) => {
        e.preventDefault();
        loginView.classList.add('hidden');
        signupView.classList.remove('hidden');
    });

    showLoginBtn.addEventListener('click', (e) => {
        e.preventDefault();
        signupView.classList.add('hidden');
        loginView.classList.remove('hidden');
    });

    // --- Navigation ---
    const showPage = (hash) => {
        if (!currentUser) return;
        const id = (hash || '#dashboard').substring(1);
        pages.forEach(page => {
             if (page.id === id) {
                page.classList.remove('hidden');
            } else {
                page.classList.add('hidden');
            }
        });
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.hash === (hash || '#dashboard')) {
                link.classList.add('active');
            }
        });
    };
    
    // --- Main Render Function ---
    const renderAll = () => {
        if (!currentUser) return;
        renderStartups();
        renderDashboard();
        renderCalendar();
        renderReportsPage();
        renderMyBookingsPage();
        renderRoomDisplaysPage();
        populateStartupDropdown();
        updateRoomAvailability(bookingDateInput.value);
        renderSettings();
        const adminOnlyElements = [document.querySelector('a[href="#startups"]'), addStartupBtn, document.querySelector('a[href="#settings"]'), document.querySelector('a[href="#reports"]'), document.querySelector('a[href="#room-displays"]')];
         const startupOnlyElements = [document.querySelector('a[href="#my-bookings"]')];
        if (currentUser.role === 'admin') {
            adminOnlyElements.forEach(el => el.style.display = 'flex');
             startupOnlyElements.forEach(el => el.style.display = 'none');
        } else {
            adminOnlyElements.forEach(el => el.style.display = 'none');
             startupOnlyElements.forEach(el => el.style.display = 'flex');
        }
    };

    // --- Time Helper Functions ---
    const parseTime = (timeStr) => {
        const [time, modifier] = timeStr.split(' ');
        let [hours, minutes] = time.split(':').map(Number);
        if (modifier === 'PM' && hours < 12) hours += 12;
        if (modifier === 'AM' && hours === 12) hours = 0;
        return hours * 60 + minutes;
    };

    const formatBookingTime = (booking) => {
        const startTimeMinutes = parseTime(booking.time);
        const endTimeMinutes = startTimeMinutes + booking.duration * 60;
        const formatMinutesToTime = (mins) => {
            const h24 = Math.floor(mins / 60) % 24;
            const m = mins % 60;
            const modifier = h24 >= 12 ? 'PM' : 'AM';
            let h12 = h24 % 12;
            if (h12 === 0) h12 = 12;
            return `${String(h12).padStart(2, '0')}:${String(m).padStart(2, '0')} ${modifier}`;
        }
        return `${booking.time} - ${formatMinutesToTime(endTimeMinutes)}`;
    };

    // --- Dashboard ---
    const renderDashboard = () => {
        totalStartupsStat.textContent = startups.length;
        const today = getTodayDateString();
        const upcomingBookings = bookings.filter(b => b.date >= today);
        upcomingBookingsStat.textContent = upcomingBookings.length;

        if (bookings.length > 0) {
            const roomCounts = bookings.reduce((acc, booking) => {
                acc[booking.room] = (acc[booking.room] || 0) + 1;
                return acc;
            }, {});
            const topRoom = Object.keys(roomCounts).reduce((a, b) => roomCounts[a] > roomCounts[b] ? a : b);
            mostBookedRoom.textContent = topRoom;
        } else {
            mostBookedRoom.textContent = 'None';
        }

        const todaysBookings = bookings.filter(b => b.date === today);
        todaysBookingsContainer.innerHTML = '';
        if (todaysBookings.length === 0) {
            todaysBookingsContainer.innerHTML = `<p class="text-center text-gray-500 py-4">No bookings scheduled for today.</p>`;
            return;
        }
        const list = document.createElement('ul');
        list.className = 'space-y-3';
        todaysBookings.sort((a,b) => parseTime(a.time) - parseTime(b.time)).forEach(booking => {
            const startup = startups.find(s => s.id === booking.startupId);
            const item = document.createElement('li');
            item.className = 'p-3 bg-gray-50 rounded-lg flex justify-between items-center border-l-4 border-green-300';
            
            if (currentUser.role === 'admin' && startup) {
                item.innerHTML = `
                    <div>
                        <p class="font-semibold text-gray-700">${booking.room} - <span class="font-normal text-gray-600">${formatBookingTime(booking)}</span></p>
                        <p class="text-sm text-gray-500">${startup.name}</p>
                        <p class="text-xs text-gray-500 mt-1">${startup.contact} - ${startup.phone}</p>
                        ${booking.equipmentNotes ? `<p class="text-xs text-gray-500 mt-1 italic">Equipment: ${booking.equipmentNotes}</p>` : ''}
                    </div>
                    <span class="text-xs font-medium text-white bg-green-600 px-2 py-1 rounded-full">Confirmed</span>
                `;
            } else {
                 item.innerHTML = `
                    <div>
                        <p class="font-semibold text-gray-700">${booking.room} - <span class="font-normal text-gray-600">${formatBookingTime(booking)}</span></p>
                    </div>
                    <span class="text-xs font-medium text-gray-700 bg-gray-200 px-2 py-1 rounded-full">Booked</span>
                `;
            }
            list.appendChild(item);
        });
        todaysBookingsContainer.appendChild(list);
    };

    // --- Startup Management ---
    const renderStartups = () => {
        startupTableBody.innerHTML = '';
        if (startups.length === 0) {
            startupTableBody.innerHTML = `<tr><td colspan="5" class="text-center p-4 text-gray-500">No startups found.</td></tr>`;
            return;
        }
        startups.forEach(startup => {
            const tr = document.createElement('tr');
            tr.className = 'border-b border-gray-200 odd:bg-white even:bg-gray-50 hover:bg-green-50';
            tr.innerHTML = `
                <td class="p-4 font-medium text-gray-800">${startup.name}</td>
                <td class="p-4 text-gray-600">${startup.contact}</td>
                <td class="p-4 text-gray-600">${startup.phone}</td>
                <td class="p-4 text-gray-600">${startup.email}</td>
                <td class="p-4">
                    <button class="edit-btn font-medium text-green-600 hover:text-green-800 mr-3" data-id="${startup.id}">Edit</button>
                    <button class="delete-btn font-medium text-red-600 hover:text-red-800" data-id="${startup.id}">Delete</button>
                </td>
            `;
            startupTableBody.appendChild(tr);
        });
    };

    const openStartupModal = (startup = null) => {
        startupForm.reset();
        if (startup) {
            modalTitle.textContent = 'Edit Startup';
            document.getElementById('startup-id').value = startup.id;
            document.getElementById('startupName').value = startup.name;
            document.getElementById('contactPerson').value = startup.contact;
            document.getElementById('phone').value = startup.phone;
            document.getElementById('email').value = startup.email;
            currentEditingStartupId = startup.id;
        } else {
            modalTitle.textContent = 'Add Startup';
            currentEditingStartupId = null;
        }
        startupModal.classList.remove('hidden');
    };

    const closeStartupModal = () => {
        startupModal.classList.add('hidden');
    };

    addStartupBtn.addEventListener('click', () => openStartupModal());
    cancelBtn.addEventListener('click', closeStartupModal);

    startupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const startupData = {
            id: currentEditingStartupId || Date.now(),
            name: document.getElementById('startupName').value,
            contact: document.getElementById('contactPerson').value,
            phone: document.getElementById('phone').value,
            email: document.getElementById('email').value,
            password: startups.find(s => s.id === currentEditingStartupId)?.password || 'password123',
            role: 'startup'
        };

        if (currentEditingStartupId) {
            startups = startups.map(s => s.id === currentEditingStartupId ? {...s, ...startupData} : s);
        } else {
            startups.push(startupData);
        }

        renderAll();
        closeStartupModal();
    });

    startupTableBody.addEventListener('click', (e) => {
        const id = parseInt(e.target.dataset.id);
        if (e.target.classList.contains('edit-btn')) {
            const startup = startups.find(s => s.id === id);
            openStartupModal(startup);
        }
        if (e.target.classList.contains('delete-btn')) {
            startups = startups.filter(s => s.id !== id);
            renderAll();
        }
    });

    // --- Booking Management ---
    const checkBookingLimits = (startupId, roomName) => {
        const roomType = availableRooms.find(r => r.name === roomName)?.type;
        if (!roomType) return { allowed: false, message: 'Invalid room selected.'};

        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();

        const monthlyBookings = bookings.filter(b => {
            const bookingDate = new Date(b.date);
            return b.startupId === startupId &&
                   bookingDate.getMonth() === currentMonth &&
                   bookingDate.getFullYear() === currentYear;
        });

        if (roomType === 'focus') {
            const focusRoomBookings = monthlyBookings.filter(b => availableRooms.find(r => r.name === b.room)?.type === 'focus').length;
            if (focusRoomBookings >= 5) {
                return { allowed: false, message: 'Booking limit reached for Focus Rooms (5 per month).' };
            }
        } else { // 'special' rooms
            const specialRoomBookings = monthlyBookings.filter(b => b.room === roomName).length;
            if (specialRoomBookings >= 1) {
                return { allowed: false, message: `Booking limit reached for ${roomName} (1 per month).` };
            }
        }
        return { allowed: true };
    };


    const populateStartupDropdown = () => {
        const currentVal = startupSelect.value;
        startupSelect.innerHTML = '<option disabled selected value="">Select a startup</option>';
        if (currentUser.role === 'admin') {
            startups.forEach(s => {
                const selected = s.id == currentVal ? 'selected' : '';
                startupSelect.innerHTML += `<option value="${s.id}" ${selected}>${s.name}</option>`;
            });
        } else {
            startupSelect.innerHTML = `<option value="${currentUser.id}" selected>${currentUser.name}</option>`;
            startupSelect.disabled = true;
        }
    };
    
    const updateRoomAvailability = (selectedDate) => {
        const bookingsForDay = bookings.filter(b => b.date === selectedDate);
        roomSelect.innerHTML = '';

        availableRooms.forEach(room => {
            const bookingsForRoom = bookingsForDay.filter(b => b.room === room.name);
            const totalBookedHours = bookingsForRoom.reduce((acc, curr) => acc + curr.duration, 0);
            
            const isFullyBooked = totalBookedHours >= 8;
            const option = document.createElement('option');
            option.value = room.name;
            option.textContent = isFullyBooked ? `${room.name} (Fully Booked)` : room.name;
            option.disabled = isFullyBooked;
            roomSelect.appendChild(option);
        });
        updateDurationAndEquipment();
    };
    
    bookingDateInput.addEventListener('change', (e) => updateRoomAvailability(e.target.value));

    const updateDurationAndEquipment = () => {
        const selectedRoomName = roomSelect.value;
        const room = availableRooms.find(r => r.name === selectedRoomName);
        if (!room) return;

        durationSelect.innerHTML = '';
        if (room.maxDuration <= 2) {
             durationSelect.innerHTML = '<option value="1">1 Hour</option><option value="2">2 Hours</option>';
        } else {
             durationSelect.innerHTML = `
                <option value="1">1 Hour</option><option value="2">2 Hours</option>
                <option value="4">4 Hours (Half Day)</option><option value="8">8 Hours (Full Day)</option>
            `;
        }

        if (room.requiresEquipment) {
            podcastEquipmentSection.classList.remove('hidden');
        } else {
            podcastEquipmentSection.classList.add('hidden');
        }
    };

    roomSelect.addEventListener('change', updateDurationAndEquipment);


    const populateTimeSlots = () => {
        timeSelect.innerHTML = '';
        timeSlots.forEach(slot => {
            timeSelect.innerHTML += `<option value="${slot}">${slot}</option>`;
        });
    };

    const setMinBookingDate = () => {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        bookingDateInput.min = tomorrow.toISOString().split('T')[0];
        bookingDateInput.value = tomorrow.toISOString().split('T')[0];
    };

    bookingForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const selectedStartupId = parseInt(startupSelect.value);
        const selectedRoomName = roomSelect.value;
        const selectedRoom = availableRooms.find(r => r.name === selectedRoomName);
        if(!selectedRoom || !selectedStartupId) return;

        // Check monthly booking limits
        const limitCheck = checkBookingLimits(selectedStartupId, selectedRoomName);
        if (!limitCheck.allowed) {
            showBookingMessage(limitCheck.message, 'red');
            return;
        }

        const newBooking = {
            id: Date.now(),
            startupId: selectedStartupId,
            room: selectedRoomName,
            date: bookingDateInput.value,
            time: timeSelect.value,
            duration: parseInt(durationSelect.value, 10),
            equipmentNotes: selectedRoom.requiresEquipment ? document.getElementById('podcast-equipment').value : '',
            isConfidential: document.getElementById('is-confidential').checked
        };
        
        if (!newBooking.startupId || !newBooking.date) {
            showBookingMessage('Please select a startup and a date.', 'red');
            return;
        }

        const newBookingStartMins = parseTime(newBooking.time);
        const newBookingEndMins = newBookingStartMins + newBooking.duration * 60;

        const isConflict = bookings.some(booking => {
            if (booking.room !== newBooking.room || booking.date !== newBooking.date) return false;
            
            const existingStartMins = parseTime(booking.time);
            const existingEndMins = existingStartMins + (booking.duration || 1) * 60;
            return newBookingStartMins < (existingEndMins + bufferMinutes) && newBookingEndMins > existingStartMins;
        });

        if (isConflict) {
            showBookingMessage(`The selected time slot is already booked or too close to another booking. Please select a different time, keeping the ${bufferMinutes}-minute buffer in mind.`, 'red');
            return;
        }

        bookings.push(newBooking);
        showBookingMessage('Booking successful! Your room is confirmed.', 'green');
        triggerConfetti();
        renderAll();
        bookingForm.reset();
        setMinBookingDate();
        updateDurationAndEquipment();
    });

    const showBookingMessage = (message, color) => {
        const colorClasses = { red: 'bg-red-100 text-red-700 border-red-400', green: 'bg-green-100 text-green-700 border-green-400' };
        bookingMessage.innerHTML = `<div class="p-4 rounded-md border-l-4 ${colorClasses[color]} font-medium">${message}</div>`;
        setTimeout(() => bookingMessage.innerHTML = '', 4000);
    };

    // --- "My Bookings" Page ---
    const renderMyBookingsPage = () => {
        if (!currentUser || currentUser.role === 'admin') {
            if (myBookingsUpcomingList) myBookingsUpcomingList.innerHTML = '';
            if (myBookingsPastList) myBookingsPastList.innerHTML = '';
            return;
        };

        const today = getTodayDateString();
        const userBookings = bookings.filter(b => b.startupId === currentUser.id);

        const upcomingBookings = userBookings
            .filter(b => b.date >= today)
            .sort((a, b) => new Date(a.date) - new Date(b.date) || parseTime(a.time) - parseTime(b.time));
            
        const pastBookings = userBookings
            .filter(b => b.date < today)
            .sort((a, b) => new Date(b.date) - new Date(a.date) || parseTime(b.time) - parseTime(a.time));

        myBookingsUpcomingList.innerHTML = '';
        if (upcomingBookings.length > 0) {
            upcomingBookings.forEach(booking => {
                const bookingEl = document.createElement('div');
                bookingEl.className = 'bg-white p-4 rounded-xl shadow-lg shadow-gray-100 flex justify-between items-center';
                bookingEl.innerHTML = `
                    <div>
                        <p class="font-bold text-lg text-gray-800">${booking.room}</p>
                        <p class="text-sm text-gray-600">${new Date(booking.date + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <p class="text-sm text-gray-500">${formatBookingTime(booking)}</p>
                    </div>
                    <button data-id="${booking.id}" class="cancel-booking-btn bg-red-100 text-red-700 px-4 py-2 rounded-lg font-semibold hover:bg-red-200 transition">Cancel</button>
                `;
                myBookingsUpcomingList.appendChild(bookingEl);
            });
        } else {
            myBookingsUpcomingList.innerHTML = '<p class="text-center text-gray-500 py-4">You have no upcoming bookings.</p>';
        }

        myBookingsPastList.innerHTML = '';
        if (pastBookings.length > 0) {
            pastBookings.forEach(booking => {
                const bookingEl = document.createElement('div');
                bookingEl.className = 'bg-white p-4 rounded-xl shadow-md opacity-70';
                bookingEl.innerHTML = `
                    <div>
                        <p class="font-bold text-lg text-gray-700">${booking.room}</p>
                        <p class="text-sm text-gray-500">${new Date(booking.date + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <p class="text-sm text-gray-500">${formatBookingTime(booking)}</p>
                    </div>
                `;
                myBookingsPastList.appendChild(bookingEl);
            });
        } else {
            myBookingsPastList.innerHTML = '<p class="text-center text-gray-500 py-4">You have no past bookings.</p>';
        }
    };
    
    appContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('cancel-booking-btn')) {
            const bookingIdToCancel = parseInt(e.target.dataset.id);
            bookings = bookings.filter(b => b.id !== bookingIdToCancel);
            renderAll();
        }
    });

    // --- Room Display Page & Kiosk Mode ---
    const renderRoomDisplaysPage = () => {
        if (!roomDisplaysGrid) return;
        roomDisplaysGrid.innerHTML = '';
        availableRooms.forEach(room => {
            const card = document.createElement('div');
            card.className = 'bg-white p-6 rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 flex flex-col items-center justify-center';
            card.innerHTML = `
                <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">${room.name}</h3>
                <button data-room-name="${room.name}" class="view-display-btn w-full py-2 px-4 rounded-lg font-semibold btn-primary">
                    View Display
                </button>
            `;
            roomDisplaysGrid.appendChild(card);
        });
    };

    const kioskEscListener = (e) => {
        if (e.key === 'Escape') {
            const modal = document.getElementById('password-modal');
            if (modal) {
                modal.remove();
            }
            e.preventDefault();
        }
    };

    const openTabletView = (roomName) => {
        tabletViewContainer.innerHTML = ''; 
        tabletViewContainer.classList.remove('hidden');
        tabletViewContainer.classList.add('flex');

        const now = new Date();
        const todayStr = getTodayDateString();
        const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();

        const currentBooking = bookings.find(b => {
            if (b.room !== roomName || b.date !== todayStr) return false;
            const startTimeInMinutes = parseTime(b.time);
            const endTimeInMinutes = startTimeInMinutes + b.duration * 60;
            return currentTimeInMinutes >= startTimeInMinutes && currentTimeInMinutes < endTimeInMinutes;
        });
        
        const nextBooking = bookings
            .filter(b => b.room === roomName && b.date === todayStr && parseTime(b.time) > currentTimeInMinutes)
            .sort((a,b) => parseTime(a.time) - parseTime(b.time))[0];

        let statusClass, statusIcon, statusText, detailsHtml = '';

        if (currentBooking) {
            const startup = startups.find(s => s.id === currentBooking.startupId);
            const bookedBy = currentBooking.isConfidential ? 'Reserved' : (startup ? startup.name : 'Unknown Startup');
            const timeInfo = formatBookingTime(currentBooking);
            
            statusClass = 'bg-gradient-to-br from-red-600 to-orange-500';
            statusIcon = `<svg class="w-16 h-16 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>`;
            statusText = 'Occupied';
            detailsHtml = `
                <p class="text-5xl font-semibold text-white/90">${bookedBy}</p>
                <p class="text-3xl mt-2 text-white/70">Until ${timeInfo.split(' - ')[1]}</p>
            `;
        } else {
            statusClass = 'bg-gradient-to-br from-green-600 to-teal-500';
            statusIcon = `<svg class="w-16 h-16 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
            statusText = 'Available';
            detailsHtml = nextBooking 
                ? `<p class="text-3xl mt-2 text-white/70">Next booking at ${nextBooking.time}</p>` 
                : '<p class="text-3xl mt-2 text-white/70">No further bookings today</p>';
        }

        tabletViewContainer.innerHTML = `
            <div class="content-wrapper relative w-full h-full flex flex-col justify-center items-center p-8 text-center ${statusClass} rounded-2xl shadow-2xl">
                <div class="absolute top-8 left-8 text-left">
                    <h1 class="text-6xl font-bold text-white" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.3);">${roomName}</h1>
                </div>
                
                <div class="flex items-center justify-center gap-x-6 mb-4">
                    ${statusIcon}
                    <h2 class="text-9xl font-extrabold text-white" style="text-shadow: 3px 3px 10px rgba(0,0,0,0.3);">${statusText}</h2>
                </div>
                ${detailsHtml}

                <div id="tablet-clock" class="absolute bottom-8 right-8 text-6xl font-bold text-white" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.3);"></div>
                <button id="exit-kiosk-btn" class="absolute bottom-8 left-8 bg-black/20 hover:bg-black/40 text-white font-semibold py-2 px-4 rounded-full text-sm transition-colors">
                    Exit Display
                </button>
            </div>
        `;

        document.getElementById('exit-kiosk-btn').addEventListener('click', promptForExitPassword);
        
        const clockInterval = setInterval(() => {
            const clockEl = document.getElementById('tablet-clock');
            if (clockEl) {
                clockEl.textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            } else {
                clearInterval(clockInterval);
            }
        }, 1000);

        document.addEventListener('keydown', kioskEscListener);
    };
    
    const promptForExitPassword = () => {
        if (document.getElementById('password-modal')) return;

        const modal = document.createElement('div');
        modal.id = 'password-modal';
        modal.className = 'absolute inset-0 bg-black/70 flex items-center justify-center z-10 p-4';
        modal.innerHTML = `
            <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-sm text-gray-800">
                <h3 class="text-2xl font-bold mb-4">Admin Authentication</h3>
                <p class="text-gray-600 mb-6">Enter your password to exit the display mode.</p>
                <div id="password-error-msg" class="text-red-500 text-sm mb-4 h-5"></div>
                <input type="password" id="admin-password-input" class="w-full border rounded-lg p-3 focus:ring-2 input-focus" placeholder="Password...">
                <div class="flex justify-end gap-4 mt-6">
                    <button id="cancel-exit-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition">Cancel</button>
                    <button id="confirm-exit-btn" class="px-6 py-2 rounded-lg font-semibold btn-primary">Confirm</button>
                </div>
            </div>
        `;
        tabletViewContainer.appendChild(modal);

        const passwordInput = document.getElementById('admin-password-input');
        passwordInput.focus();

        const verifyExitPassword = () => {
            const errorMsg = document.getElementById('password-error-msg');
            if (passwordInput.value === currentUser.password) {
                closeTabletView();
            } else {
                errorMsg.textContent = 'Incorrect password. Please try again.';
                passwordInput.value = '';
                passwordInput.focus();
                 modal.querySelector('div').classList.add('shake');
                setTimeout(() => modal.querySelector('div').classList.remove('shake'), 500);
            }
        };

        document.getElementById('confirm-exit-btn').onclick = verifyExitPassword;
        document.getElementById('cancel-exit-btn').onclick = () => modal.remove();
        passwordInput.onkeydown = (e) => {
            if (e.key === 'Enter') verifyExitPassword();
        };
    };

    const closeTabletView = () => {
        tabletViewContainer.classList.add('hidden');
        tabletViewContainer.classList.remove('flex');
        tabletViewContainer.innerHTML = '';
        document.removeEventListener('keydown', kioskEscListener);
    };

    if (roomDisplaysGrid) {
        roomDisplaysGrid.addEventListener('click', (e) => {
            if (e.target.classList.contains('view-display-btn')) {
                const roomName = e.target.dataset.roomName;
                openTabletView(roomName);
            }
        });
    }


    // --- Reports Management ---
    const populateReportSelectors = () => {
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();

        // Populate months
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        reportMonthSelect.innerHTML = '';
        months.forEach((month, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = month;
            if (index === currentMonth) {
                option.selected = true;
            }
            reportMonthSelect.appendChild(option);
        });

        // Populate years
        reportYearSelect.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const year = currentYear - i;
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            reportYearSelect.appendChild(option);
        }
    };

    const renderReportsPage = () => {
        if (!document.getElementById('reports').classList.contains('hidden')) {
            const selectedMonth = parseInt(reportMonthSelect.value);
            const selectedYear = parseInt(reportYearSelect.value);

            reportContent.innerHTML = '';

            startups.forEach(startup => {
                const monthlyBookings = bookings.filter(b => {
                    const bookingDate = new Date(b.date);
                    return b.startupId === startup.id &&
                        bookingDate.getMonth() === selectedMonth &&
                        bookingDate.getFullYear() === selectedYear;
                });

                const focusBookings = monthlyBookings.filter(b => availableRooms.find(r => r.name === b.room)?.type === 'focus').length;
                const indusBookings = monthlyBookings.filter(b => b.room === 'Indus-Board Room').length;
                const nexusBookings = monthlyBookings.filter(b => b.room === 'Nexus-Session Hall').length;
                const podcastBookings = monthlyBookings.filter(b => b.room === 'Podcast Room').length;

                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-xl shadow-lg shadow-gray-100';
                card.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mb-4">${startup.name}</h3>
                    <div class="space-y-2 text-sm">
                        <p class="flex justify-between"><span>Total Bookings:</span> <span class="font-semibold">${monthlyBookings.length}</span></p>
                        <hr>
                        <p class="flex justify-between"><span>Focus Rooms:</span> <span class="font-semibold">${focusBookings} / 5 used</span></p>
                        <p class="flex justify-between"><span>Indus-Board Room:</span> <span class="font-semibold">${indusBookings} / 1 used</span></p>
                        <p class="flex justify-between"><span>Nexus-Session Hall:</span> <span class="font-semibold">${nexusBookings} / 1 used</span></p>
                        <p class="flex justify-between"><span>Podcast Room:</span> <span class="font-semibold">${podcastBookings} / 1 used</span></p>
                    </div>
                `;
                reportContent.appendChild(card);
            });
            
            if(startups.length === 0) {
                reportContent.innerHTML = '<p class="text-gray-500 col-span-full text-center">No startups to generate a report for.</p>';
            }
        }
    };

    // --- Settings Management ---
    const renderSettings = () => {
        if (currentUser && currentUser.role === 'admin') {
            // Render rooms
            roomList.innerHTML = '';
            availableRooms.forEach(room => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
                li.innerHTML = `<span>${room.name}</span> <button data-name="${room.name}" class="delete-room-btn text-red-500 hover:text-red-700 font-semibold">Remove</button>`;
                roomList.appendChild(li);
            });

            // Render admins
            adminList.innerHTML = '';
            admins.forEach(admin => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
                li.innerHTML = `<div><p class="font-medium">${admin.name}</p><p class="text-sm text-gray-500">${admin.email}</p></div>`;
                if (admin.id !== currentUser.id) {
                     li.innerHTML += `<button data-id="${admin.id}" class="delete-admin-btn text-red-500 hover:text-red-700 font-semibold">Remove</button>`;
                }
                adminList.appendChild(li);
            });

            bufferTimeInput.value = bufferMinutes;
        }
    };
    
    addAdminForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('new-admin-email').value;
        const emailExists = startups.some(s => s.email === email) || admins.some(a => a.email === email);
        if (emailExists) {
            showAdminMessage('An account with this email already exists.', 'red');
            return;
        }
        
        const newAdmin = {
            id: 'admin_' + Date.now(),
            name: document.getElementById('new-admin-name').value,
            email: email,
            password: document.getElementById('new-admin-password').value,
            role: 'admin'
        };
        admins.push(newAdmin);
        renderSettings();
        addAdminForm.reset();
        showAdminMessage('New admin added successfully.', 'green');
    });

    adminList.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-admin-btn')) {
            const adminIdToDelete = e.target.dataset.id;
            admins = admins.filter(a => a.id !== adminIdToDelete);
            renderSettings();
        }
    });

    addRoomForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const newRoomName = document.getElementById('new-room-name').value;
        if (newRoomName && !availableRooms.some(r => r.name === newRoomName)) {
            availableRooms.push({ name: newRoomName, maxDuration: 2, requiresEquipment: false, type: 'focus' }); // Defaulting new rooms as focus rooms
            renderSettings();
            updateRoomAvailability(bookingDateInput.value);
        }
        addRoomForm.reset();
    });

    roomList.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-room-btn')) {
            const roomNameToDelete = e.target.dataset.name;
            availableRooms = availableRooms.filter(r => r.name !== roomNameToDelete);
            renderSettings();
            updateRoomAvailability(bookingDateInput.value);
        }
    });

    saveParametersBtn.addEventListener('click', () => {
        bufferMinutes = parseInt(bufferTimeInput.value, 10) || 30;
        showAdminMessage('Parameters saved successfully!', 'green', 'admin-message');
        renderSettings();
    });

    changePasswordForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        const userToUpdate = [...admins, ...startups].find(u => u.id === currentUser.id);

        if (!userToUpdate || currentPassword !== userToUpdate.password) {
            showAdminMessage('The current password you entered is incorrect.', 'red', 'password-change-message');
            return;
        }
        if (newPassword.length < 4) {
             showAdminMessage('New password must be at least 4 characters long.', 'red', 'password-change-message');
            return;
        }
        if (newPassword !== confirmPassword) {
            showAdminMessage('New passwords do not match.', 'red', 'password-change-message');
            return;
        }

        userToUpdate.password = newPassword;
        showAdminMessage('Password updated successfully!', 'green', 'password-change-message');
        changePasswordForm.reset();
    });

    const showAdminMessage = (message, color, elementId = 'admin-message') => {
         const colorClasses = { red: 'bg-red-100 text-red-700', green: 'bg-green-100 text-green-700' };
         const messageEl = document.getElementById(elementId);
         messageEl.innerHTML = `<div class="p-4 rounded-md ${colorClasses[color]}">${message}</div>`;
         setTimeout(() => messageEl.innerHTML = '', 4000);
    };

    // --- Calendar/Schedule Management ---
    const renderCalendar = () => {
        calendarGrid.innerHTML = '';
        const month = currentDate.getMonth();
        const year = currentDate.getFullYear();
        monthYearEl.textContent = currentDate.toLocaleString('en-US', { month: 'long', year: 'numeric' });
        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(day => {
            const dayEl = document.createElement('div');
            dayEl.className = 'text-center font-semibold text-sm text-gray-500 py-2';
            dayEl.textContent = day;
            calendarGrid.appendChild(dayEl);
        });
        for (let i = 0; i < firstDay; i++) {
            calendarGrid.appendChild(document.createElement('div'));
        }
        for (let date = 1; date <= lastDate; date++) {
            const dateEl = document.createElement('div');
            const fullDateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
            const bookingsForDay = bookings.filter(b => b.date === fullDateStr);
            dateEl.className = 'calendar-day text-center py-2 border rounded-lg hover:bg-gray-100 cursor-pointer transition-all';
            dateEl.textContent = date;
            dateEl.dataset.date = fullDateStr;
            if (bookingsForDay.length > 0) {
                dateEl.classList.add('calendar-day-booked', 'font-bold', 'text-green-800');
            }
            const today = new Date();
            if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                dateEl.classList.add('bg-green-600', 'text-white', 'hover:bg-green-700');
            }
            calendarGrid.appendChild(dateEl);
        }
    };

    calendarGrid.addEventListener('click', (e) => {
        if (e.target.dataset.date) {
            const date = e.target.dataset.date;
            const bookingsForDay = bookings.filter(b => b.date === date);
            scheduleDetails.innerHTML = `<h4 class="text-xl font-bold mb-3 text-gray-800">Schedule for ${new Date(date + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</h4>`;
            if (bookingsForDay.length === 0) {
                scheduleDetails.innerHTML += `<div class="bg-white p-4 rounded-lg shadow-lg shadow-gray-100"><p class="text-center text-gray-500">No bookings for this day.</p></div>`;
                return;
            }
            const list = document.createElement('ul');
            list.className = 'space-y-3 bg-white p-4 rounded-lg shadow-lg shadow-gray-100';
            bookingsForDay.sort((a,b) => parseTime(a.time) - parseTime(b.time)).forEach(booking => {
                 const startup = startups.find(s => s.id === booking.startupId);
                 const item = document.createElement('li');
                 item.className = 'p-3 bg-gray-50 rounded-lg flex justify-between items-center border-l-4 border-green-300';
                 
                if (currentUser.role === 'admin' && startup) {
                     item.innerHTML = `
                         <div>
                             <p class="font-semibold text-gray-700">${booking.room} - <span class="font-normal text-gray-600">${formatBookingTime(booking)}</span></p>
                             <p class="text-sm text-gray-500">${startup.name}</p>
                             <p class="text-xs text-gray-500 mt-1">${startup.contact} - ${startup.phone}</p>
                             ${booking.equipmentNotes ? `<p class="text-xs text-gray-500 mt-1 italic">Equipment: ${booking.equipmentNotes}</p>` : ''}
                         </div>
                     `;
                } else {
                       item.innerHTML = `
                         <div>
                             <p class="font-semibold text-gray-700">${booking.room} - <span class="font-normal text-gray-600">${formatBookingTime(booking)}</span></p>
                         </div>
                          <span class="text-xs font-medium text-gray-700 bg-gray-200 px-2 py-1 rounded-full">Booked</span>
                     `;
                }
                 list.appendChild(item);
            });
            scheduleDetails.appendChild(list);
        }
    });

    prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
        scheduleDetails.innerHTML = '';
    });

    nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
        scheduleDetails.innerHTML = '';
    });

    // --- Initial App Load ---
    const initialize = () => {
        window.addEventListener('hashchange', () => showPage(window.location.hash));
        showPage(window.location.hash || '#dashboard');
        populateTimeSlots();
        setMinBookingDate();
        if (currentUser.role === 'admin') {
            populateReportSelectors();
            if (reportMonthSelect && reportYearSelect) {
                reportMonthSelect.addEventListener('change', renderReportsPage);
                reportYearSelect.addEventListener('change', renderReportsPage);
            }
        }
    };

    handleLogin(); // Check login status on page load
});
</script>
</body>
</html>

